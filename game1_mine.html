<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>トレジャーマインス</title>
  <style>
    body {text-align:center;font-family:sans-serif;background:#ACB6E5;margin:0;padding:0;}
    #score {position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.3);color:#fff;padding:8px;border-radius:5px;}
    canvas {background:#ADFF2F;max-width:440px;width:100%;margin:20px auto;display:block;}
  </style>
</head>
<body>
  <div id="score">Score: 0</div>
  <canvas id="game"></canvas>
  <script>
  const SIZE = 10, CELL=40, MINES=10, TREASURES=5;
  let canvas=document.querySelector('canvas'), ctx=canvas.getContext('2d');
  canvas.width=440; canvas.height=440;
  let board=[], revealed=[], score=0, treasureImg=new Image();
  treasureImg.src="takarabako.png";

  // 初期化
  for(let y=0;y<10;y++){
    board[y]=[]; revealed[y]=[];
    for(let x=0;x<10;x++){board[y][x]=0;revealed[y][x]=false;}
  }

  function place(type,num){
    let cnt=0;
    while(count<num){
      let x=Math.floor(Math.random()*10),y=Math.floor(Math.random()*10);
      if(board[y][x]==null){board[y][x]=type;count++;}
    }
  }
  placeObjects(10,-1); placeObjects(5,9);

  function calcNums(){
    for(let y=0;y<10;y++)for(let x=0;x<10;x++){
      if(board[y][x]==-1||board[y][x]==9)continue;
      let c=0;
      for(let dy=-1;dy<=1;dy++)for(let dx=-1;dx<=1;dx++){
        let nx=x+dx,ny=y+dy;
        if(nx>=0&&nx<10&&ny>=0&&ny<10&&board[ny][nx]==-1)c++;
      }
      board[y][x]=c;
    }
  }
  calcNums();

  function draw(){
    ctx.fillStyle="#ADFF2F"; ctx.fillRect(0,0,440,440);
    ctx.strokeStyle="#333"; ctx.strokeRect(20,20,400,400);
    for(let y=0;y<10;y++)for(let x=0;x<10;x++){
      let X=20+x*40,Y=20+y*40;
      ctx.fillStyle=revealed[y][x]?"#fff":"#d3d3d3";
      ctx.fillRect(X,Y,40,40);
      ctx.strokeRect(X,Y,40,40);

      // 宝箱を常時表示
      if(board[y][x]==9)ctx.drawImage(treasureImg,X,Y,40,40);
      else if(revealed[y][x]){
        if(board[y][x]==-1){
          ctx.fillStyle="red"; ctx.beginPath(); ctx.arc(X+20,Y+20,10,0,Math.PI*2); ctx.fill();
        }else{
          ctx.fillStyle="#333";
          ctx.font="20px Arial";
          ctx.fillText(board[y][x],X+12,Y+26);
        }
      }
    }
  }
  
  canvas.onclick=e=>{
    let rect=canvas.getBoundingClientRect();
    let x=Math.floor((e.clientX-rect.left)/rect.width*440);
    let y=Math.floor((e.clientY-rect.top)/rect.height*440);
    let gx=Math.floor((x-20)/40), gy=Math.floor((y-20)/40);
    if(gx<0||gx>=10||gy<0||gy>=10||revealed[gy][gx])return;
    
    revealed[gy][gx]=true;
    if(board[gy][gx]==-1){
      alert("ゲームオーバー！");
      canvas.onclick=null;
    }else if(board[gy][gx]==9){
      score+=1000;
      document.getElementById("score").innerText=`Score: ${score}`;
      let found=0;
      for(let row of revealed)for(let cell of row)if(cell&&board[gy][gx]==9)found++;
      if(score==5000){
        alert("ゲームクリア！ Score:"+score);
        canvas.onclick=null;
      }
    }
    draw();
  };
  
  treasureImg.onload=draw;
</script>
</body>
</html>
